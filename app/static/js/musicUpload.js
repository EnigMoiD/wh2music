// Generated by CoffeeScript 1.6.2
(function() {
  var initializeSlider, updateProgress;

  window.sendAndConfirm = function(url) {
    var data;
    data = new FormData($('.post-song')[0]);
    initializeSlider();
    return $.ajax({
      type: 'POST',
      url: url,
      data: data,
      xhr: function() {
        var progressXhr;
        progressXhr = $.ajaxSettings.xhr();
        if (progressXhr.upload) {
          progressXhr.upload.addEventListener('progress', function(e) {
            return updateProgress(e.loaded / e.total * 100);
          });
        }
        return progressXhr;
      },
      error: function(xhr, type, e) {
        return console.log(e);
      },
      success: function(data) {
        $('#upload').remove();
        $('#uploads').removeClass('hide');
        $('#playlist').addClass('hide');
        return $('.well').append(data);
      },
      cache: false,
      contentType: false,
      processData: false
    });
  };

  initializeSlider = function() {
    return $('#uploads').addClass('hide').after('<div id="upload"><div id="slider"></div></div>');
  };

  updateProgress = function(complete) {
    if (complete === 100) {
      $('#upload').append('<p>Processing...</p>');
      return $('#upload > #slider').css('width', complete + '%');
    }
  };

  window.sendConfirmData = function(url) {
    var data;
    data = new FormData($('.post-song')[0]);
    return $.ajax({
      type: 'POST',
      url: url,
      data: data,
      success: function(data) {
        $('#playlist').removeClass('hide');
        return $('#uploadbox').remove();
      },
      cache: false,
      contentType: false,
      processData: false
    });
  };

}).call(this);
